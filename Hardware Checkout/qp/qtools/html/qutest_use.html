<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>QTools: Installation &amp; Use</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
<script type="text/javascript" src="doxygen-awesome-fragment-copy-button.js"></script>
<script type="text/javascript" src="doxygen-awesome-paragraph-link.js"></script>
<script type="text/javascript" src="ql-preview.js"></script>
<script type="text/javascript">
    DoxygenAwesomeFragmentCopyButton.init()
    DoxygenAwesomeDarkModeToggle.init()
    DoxygenAwesomeParagraphLink.init()
</script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
<link href="ql-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
  <div id="projectlogo">
    <a href="https://www.state-machine.com" title="Quantum Leaps"><img alt="Logo" src="logo_ql.png"/></a>
  </div>
   <div id="projectname">
    QTools
    &nbsp;<span id="projectnumber">7.2.1</span>
   </div>
   <div id="projectbrief">Collection of Host-Based Tools</div>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.6 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;"
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('qutest_use.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Installation &amp; Use </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><span class="prev_button"><a class="el" href="qutest.html">QUTest&trade; Unit Testing Harness</a></span><span class="next_button"><a class="el" href="qutest_conc.html">QUTest Concepts</a></span></p>
<p>In order to run tests in the QUTest test system, you need the following three components:</p>
<ol type="1">
<li>The <a class="el" href="qutest_fixture.html">test fixture</a> running on a remote target (or the host computer)</li>
<li>The <a class="el" href="qspy.html">QSPY host application</a> running and connected to the target</li>
<li>The <a class="el" href="qutest_script.html">qutest.py script runner</a> and some test scripts</li>
</ol>
<p>This section describes how to install and use the "qutest.py script runner" component.</p>
<h1><a class="anchor" id="qutest_inst"></a>
Installation</h1>
<p>The "qutest.py script runner" can be used standalone, without installation in your Python system (see <a class="el" href="qutest_use.html#qutest_exa">Examples</a> below).</p>
<dl class="section note"><dt>Note</dt><dd>The <span class="img file_py">qutest.py</span> script is included in the <a class="el" href="index.html#qtools_about">QTools&trade; collection</a>. Also, the <a class="el" href="index.html#qtools_win">QTools&trade; collection for Windows</a> already includes Python (3.8), so you don't need to install anything extra.</dd></dl>
<p>Alternatively, you can use <b>your own Python</b> installation, into which you can install the latest QUTest&trade; with <code>pip</code> from the <a href="https://pypi.org/project/qutest/"><b>PyPi index</b></a> by executing the following command:</p>
<pre class="fragment">pip install qutest
</pre><p>If you are using QUTest&trade; as a standalone Python script, you invoke it as follows:</p>
<pre class="fragment">python3 &lt;path-to-qutest-script&gt;/qutest.py &lt;command-line-options&gt;
</pre><p>Alternatively, if you've installed <code>qutest.py</code> with <code>pip</code>, you invoke it as follows:</p>
<pre class="fragment">qutest &lt;command-line-options&gt;
</pre><h1><a class="anchor" id="qutest_command"></a>
Command-line Options</h1>
<p>The Python test scripts are executed by the QUTest test script runner <code>qutest.py</code> (located in <code>qtools/qutest/</code> folder), with the following usage:</p>
<dl class="section attention"><dt>Attention</dt><dd>The <code>qutest.py</code> script runner command-line options have been expanded and changed at <a class="el" href="history.html#qtools_7_2_0">version 7.2.0</a>. Unfortunately, it was not possible to preserve the backwards compatibility with the earlier versions.</dd></dl>
<pre class="fragment">usage: python qutest.py [-h] [-v] [-e [EXE]] [-q [QSPY]] [-l [LOG]] [-o [OPT]] [scripts ...]

QUTest test script runner

positional arguments:
  scripts               List (comma-separated) of test scripts to run

options:
  -h, --help            show this help message and exit
  -v, --version         Display QUTest version
  -e [EXE], --exe [EXE]
                        Optional host executable or debug/DEBUG
  -q [QSPY], --qspy [QSPY]
                        optional qspy host, [:ud_port][:tcp_port]
  -l [LOG], --log [LOG]
                        Optional log directory (might not exist yet)
  -o [OPT], --opt [OPT]
                        xciob: x:exit-on-fail,i:inter,c:qspy-clear,o:qspy-save-txt,b:qspy-save-bin

More info: https://www.state-machine.com/qtools/qutest.html
</pre><p>where:<br  />
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">[scripts]</td><td>optional specification of the Python test scripts to run. If not specified, <code>qutest.py</code> will try to run all *.py files in the current directory as test scripts.</td></tr>
    <tr><td class="paramname">-e[exe]</td><td>optional specification of the host executable to launch for testing embedded code on the host computer. If <code>exe</code> is <b>not</b> specified a remote (embedded) target is assumed. The special value <code>debug</code> or <code>DEBUG</code> means that <code>qutest.py</code> will start in the <b>debug mode</b>, in which it will NOT launch the host executable and it will wait for the Target reset and other responses from the Target.</td></tr>
    <tr><td class="paramname">-q[host][:ud_port][:tcp_port]</td><td>optional host-name/IP-address:udp_port:tcp_port for the machine running the QSpy utility. If not specified, the default is <code>localhost:7701:6601</code>.</td></tr>
    <tr><td class="paramname">-l[log]</td><td>Optional directory for output of the log file (directory will be created if it does not exist yet).</td></tr>
    <tr><td class="paramname">-o[opt]</td><td>options for the QUTest script runner to perform the following actions:<br  />
 x : exit on first failed test<br  />
 i : interactive mode<br  />
 c : clear the QSPY screen just after attaching<br  />
 o : save the QSPY text output to a file (in the QSPY launch directory)<br  />
 b : save the QSPY binary output to a file (in the QSPY launch directory)</td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Note</dt><dd>For reliable operation it is recommended to apply the short options <em>without</em> a space between the option and the parameter (e.g., <code>-q192.168.1.100</code>, <code>-oci</code>).</dd></dl>
<h1><a class="anchor" id="qutest_exa"></a>
Examples</h1>
<p><img src="img/logo_win48.png" alt="" style="float:left; clear:left; margin-right:10px" class="inline"/> </p>
<h2><a class="anchor" id="qutest_exa_win"></a>
Windows Hosts</h2>
<div style="clear:both"></div><pre class="fragment">[1] python3 %QTOOLS%\qutest\qutest.py
[2] python3 %QTOOLS%\qutest\qutest.py -- test_mpu.py
[3] python3 %QTOOLS%\qutest\qutest.py -ebuild/test_dpp.exe
[4] python3 %QTOOLS%\qutest\qutest.py -ebuild/test_dpp.exe -q192.168.1.100 -l../log -oco
[5] qutest -qlocalhost:7702 -oxc --  test_qk.py,test_mpu.py
[6] python3 %QTOOLS%\qutest\qutest.py -eDEBUG -- test_mpu.py
</pre><p><code>[1]</code> runs all test scripts (<code>*.py</code>) in the current directory on a remote target connected to QSPY host utility.</p>
<p><code>[2]</code> runs the test script <code>test_mpu.py</code> in the current directory on a remote target connected to QSPY host utility.</p>
<p><code>[3]</code> runs all test scripts (<code>*.py</code>) in the current directory and uses the host executable <code>build/test_dpp.exe</code> (test fixture).</p>
<p><code>[4]</code> runs all test scripts (<code>*.py</code>) in the current directory, uses the host executable <code>build/test_dpp.exe</code> (test fixture), and connects to QSPY running on a machine with IP address <code>192.168.1.100</code>. Also produces QUTest log (-l) in the directory <code>../log</code>. Also clears the QUTest screen before the run (-oc) and causes QSPY to save the text output to a file (-oo)</p>
<p><code>[5]</code> runs "qutest" (<b>installed with pip</b>) to execute the test scripts <code>test_qk.py,test_mpu.py</code> in the current directory, and connects to QSPY at UDP-host:port <code>localhost:7701</code>.</p>
<p><code>[6]</code> runs "qutest" in the DEBUG mode to execute the test script <code>test_mpu.py</code> in the current directory.</p>
<p><br  />
 <img src="img/logo_linux48.png" alt="" style="float:left; clear:left; margin-right:10px" class="inline"/> <img src="img/logo_macos48.png" alt="" style="float:left; margin-right:10px" class="inline"/> </p>
<h2><a class="anchor" id="qutest_exa_posiz"></a>
Linux/macOS Hosts</h2>
<div style="clear:both"></div><pre class="fragment">[1] python3 $(QTOOLS)/qutest/qutest.py
[2] python3 $(QTOOLS)/qutest/qutest.py -- test_mpu.py
[3] python3 $(QTOOLS)/qutest/qutest.py -ebuild/test_dpp
[4] python3 $(QTOOLS)/qutest/qutest.py -ebuild/test_dpp -q192.168.1.100 -l../log -oco
[5] qutest -qlocalhost:7702 -oxc --  test_qk.py,test_mpu.py
[6] python3 $(QTOOLS)/qutest/qutest.py -eDEBUG -- test_mpu.py
</pre><p><code>[1]</code> runs all test scripts (<code>*.py</code>) in the current directory on a remote target connected to QSPY host utility.</p>
<p><code>[2]</code> runs the test script <code>test_mpu.py</code> in the current directory on a remote target connected to QSPY host utility.</p>
<p><code>[3]</code> runs all test scripts (<code>*.py</code>) in the current directory and uses the host executable <code>build/test_dpp</code> (test fixture).</p>
<p><code>[4]</code> runs all test scripts (<code>*.py</code>) in the current directory, uses the host executable <code>build/test_dpp</code> (test fixture), and connects to QSPY running on a machine with IP address <code>192.168.1.100</code>. Also produces QUTest log (-l) in the directory <code>../log</code>. Also clears the QUTest screen before the run (-oc) and causes QSPY to save the text output to a file (-oo)</p>
<p><code>[5]</code> runs "qutest" (<b>installed with pip</b>) to execute the test scripts <code>test_qk.py,test_mpu.py</code> in the current directory, and connects to QSPY at UDP-host:port <code>localhost:7701</code>.</p>
<p><code>[6]</code> runs "qutest" in the DEBUG mode to execute the test script <code>test_mpu.py</code> in the current directory.</p>
<h1><a class="anchor" id="qutest_inter"></a>
Interactive Mode</h1>
<p>Similar to the Python interpreter itself, the <code>qutest.py</code> test runner has two basic modes: script (default) and interactive. In the default script mode, <code>qutest.py</code> runs the provided <a class="el" href="qutest_script.html">test scripts</a> and exits. In the <b>interactive mode</b> the reads and executes commands <em>interactively</em> from the terminal input. The interactive mode is activated by providing the <code>-oi</code> <a class="el" href="qutest_use.html#qutest_command">command-line option</a>. Interactive mode is a good way to play around and try the system's response to various commands. Also, interactive mode can be used to provide stimuli for debugging the <a class="el" href="qutest_fixture.html">test fixture</a>.</p>
<p>Once activated, the interactive mode works as follows:</p>
<ul>
<li>If any test scripts are provided, after each test group (test script) the test runner enters an interactive session, where the user can manually enter any supported test commands. These commands are executed in the context of the <em>last test in the group</em>. Tt is also possible to start a new test interactively (by providing the <a class="el" href="namespacequtest__dsl.html#ac0d4e644cd63337f7214b45a483e9c3d">test()</a> command). In that case, the interactively entered commands will be executed in the context of the new test.</li>
<li>If no test scripts are provided, the test runner enters an interactive session immediately. In that case, the user must provide the <a class="el" href="namespacequtest__dsl.html#ac0d4e644cd63337f7214b45a483e9c3d">test()</a> command manually (perhaps after defining the <a class="el" href="qutest_script.html#qutest_dsl-preamble">test callbacks</a>).</li>
</ul>
<p>In either case, the interactive mode is shown by the presence of the <code>&gt;&gt;&gt;</code> command prompt. During an interactive session the output produced by the text fixture is displayed on the screen and <b>not</b> checked against any expectations. In fact, the <a class="el" href="namespacequtest__dsl.html#ac04e5d768c1af3bbae0b177d0beb4d95">expect()</a> command itself makes no sense in the interactive mode. Also, all tests that are interactive are considered "SIKPPED" and are not evaluated as "PASS" or "FAIL".</p>
<dl class="section note"><dt>Note</dt><dd>You can use the up- and down-arrow keys to navigate through the list of previous commands. You end the interactive session by providing an "empty" command, that is by pressing the <code>&lt;Enter&gt;</code> key right at the <code>&gt;&gt;&gt;</code> command prompt</dd></dl>
<p>Here is an example of an interactive session with test scripts provided. (Note the annotations added after the <code>//</code> comments).</p>
<pre class="fragment">C:\qp\qpc\examples\qutest\qhsmtst\test&gt;make OPT=i   // &lt;--- NOTE OPT=i

python3 C:\qp\qtools/qutest/qutest.py -ebuild/test_qhsmtst.exe -q -l -oci --

QUTest unit testing front-end 7.2.1 running on Python 3.10.1
Copyright (c) 2005-2022 Quantum Leaps, www.state-machine.com
Attaching to QSpy (localhost:7701) ... OK

Run ID    : 230111_174610
Target    : build/test_qhsmtst.exe

==================================[Group  1]==================================
test_qhsm-funct.py
[ 1]--------------------------------------------------------------------------
QHsmTst_init
                                                             [ PASS (  0.1s) ]
[ 2]^-------------------------------------------------------------------------
QHsmTst dispatch
&gt;&gt;&gt; dispatch('A_SIG')      // &lt;--- interactive command
0000000127 BSP_DISPLAY s1-A;
0000000128 BSP_DISPLAY s11-EXIT;
0000000129 BSP_DISPLAY s1-EXIT;
0000000130 BSP_DISPLAY s1-ENTRY;
0000000131 BSP_DISPLAY s1-INIT;
0000000132 BSP_DISPLAY s11-ENTRY;
0000000133 Trg-Done QS_RX_EVENT
&gt;&gt;&gt; dispatch('B_SIG')      // &lt;--- interactive command
0000000134 BSP_DISPLAY s1-B;
0000000135 BSP_DISPLAY s11-EXIT;
0000000136 BSP_DISPLAY s11-ENTRY;
0000000137 Trg-Done QS_RX_EVENT
&gt;&gt;&gt;                        // &lt;--- end of interactive session
                          interactive test shows as "skipped" ---&gt; [ SKIPPED ]

==================================[Group  2]==================================
test_qhsm-struct.py
[ 3]--------------------------------------------------------------------------
QHsmTst init
                                                             [ PASS (  0.1s) ]
[ 4]^-------------------------------------------------------------------------
QHsmTst dispatch
&gt;&gt;&gt;                        // &lt;--- end of interactive session
                                                                   [ SKIPPED ]

==================================[ SUMMARY ]=================================

Target ID : 230111_170758 (QP-Ver=721)
Log file  :
Groups    : 2
Tests     : 4
Skipped   : 2 [ 2 4 ]
Failed    : 0

==============================[  OK  ( 20.1s) ]===============================
</pre><h1><a class="anchor" id="qutest_log"></a>
Generating Test Logs</h1>
<p>As required for safety certification, the <code>qutest.py</code> test runner can generate permanent records of the runs by producing <b>log files</b>. This feature is enabled by the <code>-l&lt;log-dir&gt;</code> command-line option.</p>
<dl class="section remark"><dt>Remarks</dt><dd>The various make-files supplied in QP/C and QP/C++ allow you to supply the command-line options for saving QUTest logs (by defining the <code>LOG=</code> symbol while invoking <code>make</code>), for example: <pre class="fragment">[1] make LOG=.
[2] make LOG=../log
[3] make LOG=c:/cert/logs
</pre> <code>[1]</code> generates QUTest log file in the current directory (<code>.</code>)</dd></dl>
<p><code>[2]</code> generates QUTest log file in the <code>../log</code> directory (relative to the current directory)</p>
<p><code>[3]</code> generates QUTest log file in the absolute directory <code>c:/cert/logs</code></p>
<p>The following following listing shows the generated log file:</p>
<p>The following screen shot shows the qutest.py screen output in which a log file has been produced (with the <code>-l.</code> command-line option):</p>
<div class="image">
<img src="qutest-out.png" alt=""/>
</div>
 <p>And the following listing shows the generated log file:</p>
<pre class="fragment">Run ID    : 221221_161550
Target    : build/test_qutest.exe

===================================[group]====================================
test_assert.py

This test group contains tests that intenionally FAIL,
to exercise failure modes of the QUTest system.

[ 1]--------------------------------------------------------------------------
Expected assertion
                                                             [ PASS (  0.1s) ]
[ 2]--------------------------------------------------------------------------
Unexpected assertion (should FAIL!)
  @test_assert.py:22
exp: "0000000002 COMMAND CMD_A 0"
got: "0000000002 =ASSERT= Mod=test_qutest,Loc=100"
! ! ! ! ! ! ! ! ! ! ! ! ! ! ! ! ! ! ! ! ! ! ! ! ! ! ! ! ! ! ![ FAIL (  0.2s) ]
[ 3]--------------------------------------------------------------------------
Simple passing test
                                                             [ PASS (  0.1s) ]
[ 4]--------------------------------------------------------------------------
Wrong assertion expectation (should FAIL!)
  @test_assert.py:32
exp: "0000000002 =ASSERT= Mod=test_qutest,Loc=200"
got: "0000000002 =ASSERT= Mod=test_qutest,Loc=100"
! ! ! ! ! ! ! ! ! ! ! ! ! ! ! ! ! ! ! ! ! ! ! ! ! ! ! ! ! ! ![ FAIL (  1.1s) ]
[ 5]--------------------------------------------------------------------------
Simple passing test
                                                             [ PASS (  0.1s) ]

=================================[ SUMMARY ]==================================

Target ID : 221221_161031 (QP-Ver=720)
Log file  : ./qutest221221_161550.txt
Groups    : 1
Tests     : 5
Skipped   : 0
FAILED    : 2 [ 2 4 ]

==============================[ FAIL (  2.7s) ]===============================
</pre><h1><a class="anchor" id="qutest_qspy_log"></a>
Generating QSPY Logs</h1>
<p>Additionally, it is also possible to generate logs files from the QSPY output. This feature is enabled by the <code>-oo</code> and <code>-ob</code> command-line options.</p>
<ul>
<li>the option <code>-oo</code> saves the QSPY text output generated during the qutest.py run. QSPY saves the output in the directory from which it was launched.</li>
<li>the option <code>-ob</code> saves the QSPY raw binary output received from the test fixture during the qutest.py run. QSPY saves the output in the directory from which it was launched.</li>
</ul>
<dl class="section remark"><dt>Remarks</dt><dd>The various make-files supplied in QP/C and QP/C++ allow you to supply the command-line options for saving QSPY logs (by defining the <code>OPT=</code> symbol while invoking <code>make</code>), for example: <pre class="fragment">[1] make OPT=o
[2] make OPT=b
[3] make OPT=ob
</pre> <code>[1]</code> generates QSPY text output (in the QSPY launch directory)<br  />
 <code>[2]</code> generates QSPY binary output (in the QSPY launch directory)<br  />
 <code>[3]</code> generates both QSPY text and binary outputs (in the QSPY launch directory)</dd></dl>
<p><span class="prev_button"><a class="el" href="qutest.html">QUTest&trade; Unit Testing Harness</a></span><span class="next_button"><a class="el" href="qutest_conc.html">QUTest Concepts</a></span> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.9.2-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="qutest.html">QUTest&trade; Unit Testing Harness</a></li>
    <li class="footer">
<a title="Quantum Leaps: Modern Embedded Software" href="https://www.state-machine.com">&copy; 2005-2023 Quantum Leaps</a> &nbsp;|&nbsp; <a title="help" href="help.html">Using Online Help</a> &nbsp;|&nbsp; <b>QTools 7.2.1</b> &nbsp;|&nbsp; Updated on Thu Jan 26 2023
<hr class="footer"/><address class="footer"><small>
<a title="Quantum Leaps: Modern Embedded Software" href="https://www.state-machine.com">&copy; 2005-2023 Quantum Leaps</a> &nbsp;|&nbsp; <a title="help" href="help.html">Using Online Help</a> &nbsp;|&nbsp; <b>QTools 7.2.1</b> &nbsp;|&nbsp; Updated on Thu Jan 26 2023
</small></address>
    </li>
  </ul>
</div>
</body>
</html>
