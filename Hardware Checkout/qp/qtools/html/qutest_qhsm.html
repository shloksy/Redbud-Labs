<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>QTools: Hierarchical State Machine Example</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
<script type="text/javascript" src="doxygen-awesome-fragment-copy-button.js"></script>
<script type="text/javascript" src="doxygen-awesome-paragraph-link.js"></script>
<script type="text/javascript" src="ql-preview.js"></script>
<script type="text/javascript">
    DoxygenAwesomeFragmentCopyButton.init()
    DoxygenAwesomeDarkModeToggle.init()
    DoxygenAwesomeParagraphLink.init()
</script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
<link href="ql-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
  <div id="projectlogo">
    <a href="https://www.state-machine.com" title="Quantum Leaps"><img alt="Logo" src="logo_ql.png"/></a>
  </div>
   <div id="projectname">
    QTools
    &nbsp;<span id="projectnumber">7.2.1</span>
   </div>
   <div id="projectbrief">Collection of Host-Based Tools</div>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.6 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;"
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('qutest_qhsm.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Hierarchical State Machine Example </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><span class="prev_button"><a class="el" href="qutest_mock.html">Unity Mock Example</a></span><span class="next_button"><a class="el" href="qutest_blinky.html">Blinky Example</a></span></p>
<p>This example shows how to apply QUTest for unit-testing <a href="https://www.state-machine.com/doc/concepts.php#HSM">Hierarchical State Machines</a>. This example illustrates two testing strategies for state machines: </p>
<ul>
<li><b>Functional tests</b> focus on the <em>actions</em> performed by the state machine.</li>
</ul>
<blockquote class="doxtable">
<p>&zwj;<b>NOTE:</b> As described in the <a class="el" href="qutest_mock.html">Unity Mock Example</a>, testing of complex, multi-stage interactions (such as a state machine) typically requires application of a "mock object" test double. However, the QUTest design philosophy allows you to use a much simpler "spy object" test double instead. The <b>functional testing</b> strategy illustrates this approach. </p>
</blockquote>
<ul>
<li><b>Structural tests</b> focus on the state machine structure, such as entering/exiting <em>states</em> and executing <em>state transitions</em>.</li>
</ul>
<blockquote class="doxtable">
<p>&zwj;<b>NOTE:</b> Unlike the previous examples (<a class="el" href="qutest_unity.html">Unity-basic</a> and <a class="el" href="qutest_mock.html">Unity-mock</a>), which pertained to generic C code, the <b>structural testing</b> of state machine makes use of the specific state machine instrumentation that is provided in QP. </p>
</blockquote>
<dl class="section remark"><dt>Remarks</dt><dd>In practice, unit-testing of state machines typically involves a mixture of functional and structural testing strategies.</dd></dl>
<h1><a class="anchor" id="qutest_qhsm-cut"></a>
Code Under Test (CUT)</h1>
<p>This example is available in both <a href="https://www.state-machine.com/qpc"><b>QP/C</b></a> as well as in <a href="https://www.state-machine.com/qpcpp"><b>QP/C++</b></a> frameworks.The complete code for the <code>qhsm</code> example is provided in the directory <span class="img folder"><code>&lt;qpc|qpcpp&gt;\examples\qutest\qhsmtst</code></span>.</p>
<p>The hierarchical state machine used in this example is artificial, but it has been specifically designed to contain all possible state transition topologies for up to 4 levels of state nesting. The code representing this state machine (the CUT here), has been generated automatically by the <a href="https://www.state-machine.com/qm/">QM modeling tool</a> from the model shown in the screen-shot below:</p>
<div class="image">
<img src="qhsmtst_qm.png" alt=""/>
<div class="caption">
QHsmTst state machine in QM</div></div>
    <p>The state machine executes actions on every entry/exit to states, on state transitions and on internal state transitions. These actions are all implemented by calling the <code>BSP_display()</code> function that outputs a succinct message about the location of the action within the state machine. For example, the entry action to state "s2" calls <code>BSP_display("s2-ENTRY;")</code> and the exit action from state "s2" calls <code>BSP_display("s2-EXIT;")</code>. These actions then are used for <a class="el" href="qutest_qhsm.html#qutest_qhsm-funct-script">functional testing</a> of the state machine.</p>
<h1><a class="anchor" id="qutest_qhsm-run"></a>
Running the Test</h1>
<p>To run the <code>qhsm</code> tests (on Windows), open a command prompt and type:</p>
<pre class="fragment">qspy
</pre><p>This will start the <a class="el" href="qspy.html">QSPY</a> host application with the TCP/IP connection to the Target.</p>
<p>Next, open another command prompt window and type:</p>
<pre class="fragment">cd C:\qp\&lt;qpc|qpcpp&gt;\examples\qutest\qhsmtst\test
make
</pre><p>This will build the <a class="el" href="qutest_qhsm.html#qutest_qhsm-fixture">test fixture</a> as a Windows executable and then it will run the <a class="el" href="qutest_qhsm.html#qutest_qhsm-funct-script">test script</a>. The screen shot below shows the output produced in these two command-prompt windows.</p>
<div class="image">
<img src="test_qhsm.jpg" alt=""/>
<div class="caption">
QUTest QHsm test run</div></div>
    <h1><a class="anchor" id="qutest_qhsm-fixture"></a>
Test Fixture</h1>
<p>The following listing shows the test fixture for the QHsm tests (file <span class="img file_c"><code>test_qhsm.c</code></span>). This test fixture is used in both <a class="el" href="qutest_qhsm.html#qutest_qhsm-funct-script">functional</a> and <a class="el" href="qutest_qhsm.html#qutest_qhsm-struct-script">structural</a> tests. The explanation section following the listing clarifies the interesting lines of code (lines starting with [xx] labels).</p>
<div class="fragment"><div class="line"><span class="preprocessor">    #include &quot;qpc.h&quot;</span>       <span class="comment">/* QUTest interface */</span></div>
<div class="line"><span class="preprocessor">    #include &quot;qhsmtst.h&quot;</span>   <span class="comment">/* CUT */</span></div>
<div class="line"> </div>
<div class="line">    Q_DEFINE_THIS_FILE</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">enum</span> {</div>
<div class="line">[1]     BSP_DISPLAY = <a class="code hl_enumvalue" href="qpc__qs_8h.html#a48cec974671d01f280b2b1a33225d176">QS_USER</a>,</div>
<div class="line">    };</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/*--------------------------------------------------------------------------*/</span></div>
<div class="line">    <span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[]) {</div>
<div class="line">        <span class="keyword">static</span> QF_MPOOL_EL(QEvt) smlPoolSto[10]; <span class="comment">/* small pool */</span></div>
<div class="line"> </div>
<div class="line">        QF_init();    <span class="comment">/* initialize the framework */</span></div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* initialize the QS software tracing */</span></div>
<div class="line">        Q_ALLEGE(<a class="code hl_define" href="qpc__qs_8h.html#af22371611fe57862a37eb785debb7921">QS_INIT</a>(argc &gt; 1 ? argv[1] : (<span class="keywordtype">void</span> *)0));</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* initialize event pools... */</span></div>
<div class="line">        QF_poolInit(smlPoolSto, <span class="keyword">sizeof</span>(smlPoolSto), <span class="keyword">sizeof</span>(smlPoolSto[0]));</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* dictionaries... */</span></div>
<div class="line">[2]     <a class="code hl_define" href="qpc__qs_8h.html#a3b1ab21c174f2bec448edec8865a8529">QS_FUN_DICTIONARY</a>(&amp;QHsm_top);</div>
<div class="line">[3]     <a class="code hl_define" href="qpc__qs_8h.html#a034206ff7f20a4e6426a5f554434643b">QS_OBJ_DICTIONARY</a>(the_hsm);</div>
<div class="line">[4]     <a class="code hl_define" href="qpc__qs_8h.html#ae75893daa66c6d0b5a6dfb8f3fca1196">QS_USR_DICTIONARY</a>(BSP_DISPLAY);</div>
<div class="line"> </div>
<div class="line">[5]     QHsmTst_ctor(); <span class="comment">/* instantiate the QHsmTst object */</span></div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span> QF_run();</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/*--------------------------------------------------------------------------*/</span></div>
<div class="line">[6] <span class="keywordtype">void</span> BSP_display(<span class="keywordtype">char</span> <span class="keyword">const</span> *msg) {</div>
<div class="line">[7]     QS_BEGIN(BSP_DISPLAY, (<span class="keywordtype">void</span> *)0) <span class="comment">/* application-specific record */</span></div>
<div class="line">[8]         <a class="code hl_define" href="qpc__qs_8h.html#a7ad67719163eea844e44bee7f0478c0a">QS_STR</a>(msg);</div>
<div class="line">        <a class="code hl_define" href="qpc__qs_8h.html#a2ed1002d3dda6d95f9f64c59b8453c71">QS_END</a>()</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/*..........................................................................*/</span></div>
<div class="line">    <span class="keywordtype">void</span> BSP_exit(<span class="keywordtype">void</span>) {</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/*--------------------------------------------------------------------------*/</span></div>
<div class="line">    <span class="keywordtype">void</span> <a class="code hl_function" href="qpc__qs_8h.html#a3d316077c13f8033c1a391590937e696">QS_onTestSetup</a>(<span class="keywordtype">void</span>) {</div>
<div class="line">    }</div>
<div class="line">    <span class="comment">/*..........................................................................*/</span></div>
<div class="line">    <span class="keywordtype">void</span> <a class="code hl_function" href="qpc__qs_8h.html#abefe60a3ba6b11d5406bba4708a48f2d">QS_onTestTeardown</a>(<span class="keywordtype">void</span>) {</div>
<div class="line">    }</div>
<div class="line">    <span class="comment">/*..........................................................................*/</span></div>
<div class="line">    <span class="keywordtype">void</span> QS_onCommand(uint8_t cmdId,</div>
<div class="line">                      uint32_t param1, uint32_t param2, uint32_t param3)</div>
<div class="line">    {</div>
<div class="line">        (void)param1;</div>
<div class="line">        (void)param2;</div>
<div class="line">        (void)param3;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">switch</span> (cmdId) {</div>
<div class="line">           <span class="keywordflow">case</span> 0U: {</div>
<div class="line">               <span class="keywordflow">break</span>;</div>
<div class="line">           }</div>
<div class="line">           <span class="keywordflow">default</span>:</div>
<div class="line">               <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/*..........................................................................*/</span></div>
<div class="line"><span class="preprocessor">    #ifdef Q_HOST  </span><span class="comment">/* is this test compiled for a desktop Host computer? */</span><span class="preprocessor"></span><span class="comment"></span></div>
<div class="line"><span class="comment">    /*! host callback function to &quot;massage&quot; the event, if necessary */</span><span class="preprocessor"></span></div>
<div class="line">    <span class="keywordtype">void</span> <a class="code hl_function" href="qpc__qs_8h.html#ad3f890b82210f9d63348d9764bdc1073">QS_onTestEvt</a>(QEvt *e) {</div>
<div class="line">        (void)e;</div>
<div class="line">    }</div>
<div class="line"><span class="preprocessor">    #else </span><span class="comment">/* this test is compiled for an embedded Target system */</span><span class="preprocessor"></span></div>
<div class="line">    <span class="keywordtype">void</span> <a class="code hl_function" href="qpc__qs_8h.html#ad3f890b82210f9d63348d9764bdc1073">QS_onTestEvt</a>(QEvt *e) {</div>
<div class="line">        (void)e;</div>
<div class="line">    }</div>
<div class="line"><span class="preprocessor">    #endif</span></div>
<div class="ttc" id="aqpc__qs_8h_html_a034206ff7f20a4e6426a5f554434643b"><div class="ttname"><a href="qpc__qs_8h.html#a034206ff7f20a4e6426a5f554434643b">QS_OBJ_DICTIONARY</a></div><div class="ttdeci">#define QS_OBJ_DICTIONARY(obj_)</div><div class="ttdef"><b>Definition:</b> <a href="qpc__qs_8h_source.html#l01331">qpc_qs.h:1331</a></div></div>
<div class="ttc" id="aqpc__qs_8h_html_a2ed1002d3dda6d95f9f64c59b8453c71"><div class="ttname"><a href="qpc__qs_8h.html#a2ed1002d3dda6d95f9f64c59b8453c71">QS_END</a></div><div class="ttdeci">#define QS_END()</div><div class="ttdef"><b>Definition:</b> <a href="qpc__qs_8h_source.html#l01082">qpc_qs.h:1082</a></div></div>
<div class="ttc" id="aqpc__qs_8h_html_a3b1ab21c174f2bec448edec8865a8529"><div class="ttname"><a href="qpc__qs_8h.html#a3b1ab21c174f2bec448edec8865a8529">QS_FUN_DICTIONARY</a></div><div class="ttdeci">#define QS_FUN_DICTIONARY(fun_)</div><div class="ttdef"><b>Definition:</b> <a href="qpc__qs_8h_source.html#l01366">qpc_qs.h:1366</a></div></div>
<div class="ttc" id="aqpc__qs_8h_html_a3d316077c13f8033c1a391590937e696"><div class="ttname"><a href="qpc__qs_8h.html#a3d316077c13f8033c1a391590937e696">QS_onTestSetup</a></div><div class="ttdeci">void QS_onTestSetup(void)</div></div>
<div class="ttc" id="aqpc__qs_8h_html_a48cec974671d01f280b2b1a33225d176"><div class="ttname"><a href="qpc__qs_8h.html#a48cec974671d01f280b2b1a33225d176">QS_USER</a></div><div class="ttdeci">@ QS_USER</div><div class="ttdef"><b>Definition:</b> <a href="qpc__qs_8h_source.html#l00306">qpc_qs.h:306</a></div></div>
<div class="ttc" id="aqpc__qs_8h_html_a7ad67719163eea844e44bee7f0478c0a"><div class="ttname"><a href="qpc__qs_8h.html#a7ad67719163eea844e44bee7f0478c0a">QS_STR</a></div><div class="ttdeci">#define QS_STR(str_)</div><div class="ttdef"><b>Definition:</b> <a href="qpc__qs_8h_source.html#l01186">qpc_qs.h:1186</a></div></div>
<div class="ttc" id="aqpc__qs_8h_html_abefe60a3ba6b11d5406bba4708a48f2d"><div class="ttname"><a href="qpc__qs_8h.html#abefe60a3ba6b11d5406bba4708a48f2d">QS_onTestTeardown</a></div><div class="ttdeci">void QS_onTestTeardown(void)</div></div>
<div class="ttc" id="aqpc__qs_8h_html_ad3f890b82210f9d63348d9764bdc1073"><div class="ttname"><a href="qpc__qs_8h.html#ad3f890b82210f9d63348d9764bdc1073">QS_onTestEvt</a></div><div class="ttdeci">void QS_onTestEvt(QEvt *e)</div></div>
<div class="ttc" id="aqpc__qs_8h_html_ae75893daa66c6d0b5a6dfb8f3fca1196"><div class="ttname"><a href="qpc__qs_8h.html#ae75893daa66c6d0b5a6dfb8f3fca1196">QS_USR_DICTIONARY</a></div><div class="ttdeci">#define QS_USR_DICTIONARY(rec_)</div><div class="ttdef"><b>Definition:</b> <a href="qpc__qs_8h_source.html#l01376">qpc_qs.h:1376</a></div></div>
<div class="ttc" id="aqpc__qs_8h_html_af22371611fe57862a37eb785debb7921"><div class="ttname"><a href="qpc__qs_8h.html#af22371611fe57862a37eb785debb7921">QS_INIT</a></div><div class="ttdeci">#define QS_INIT(arg_)</div><div class="ttdef"><b>Definition:</b> <a href="qpc__qs_8h_source.html#l00995">qpc_qs.h:995</a></div></div>
</div><!-- fragment --> <dl class="tag">
<dt>1</dt>
<dd>The <code>BSP_DISPLAY</code> enumeration will be used as the record-ID for the <a class="el" href="qs.html#qs_app">application-specific trace record</a>.  <blockquote class="doxtable">
<p>&zwj;<b>NOTE:</b> The record-ID is offset by <a class="el" href="qpc__qs_8h.html#a48cec974671d01f280b2b1a33225d176">QS_USER</a>. </p>
</blockquote>
</dd>
<dt>2</dt>
<dd>This line produces a <a class="el" href="qs.html#qs_dict">function dictionary</a> for the <a href="https://www.state-machine.com/qpc/qep_8h.html#ac8ae4728dfab5ce26a907fc624f6e104">QHsm_top() function</a>.  </dd>
<dt>3</dt>
<dd>This line produces a <a class="el" href="qs.html#qs_dict">object dictionary</a> for the <code>l_hsm</code> state machine object to test.  </dd>
<dt>4</dt>
<dd>This line produces a <a class="el" href="qs.html#qs_dict">user dictionary</a> for the application-specific trace record defined at label [1].  </dd>
<dt>5</dt>
<dd>The "constructor" of the state machine object is called.  <b>NOTE:</b> The explicit "constructor" call is needed only in C. In C++, static constructors are called automatically as part of the startup sequence.  </dd>
</dl>
<div style="clear:both;"></div><h2><a class="anchor" id="qutest_qhsm-act"></a>
Action Functions Test Doubles</h2>
<p>For functional testing, which is focused on the <b>actions</b> performed by a state machine, the actions must generate some QS output. This QS instrumentation can be added either directly to the state machine model, or indirectly to the functions called from the state machine actions. The test fixture above illustrates the second option, because it was more convenient in this case (see <code>BSP_display()</code> implementation starting at label [6] above).</p>
<dl class="tag">
<dt>6</dt>
<dd>The function <code>BSP_display()</code> is called from all actions of the state machine. Inside the test fixture, this function is defined to produce QS output. This is a classic example of a "spy" test double.  </dd>
<dt>7</dt>
<dd>The QS output is produced with an <a class="el" href="qs.html#qs_app">application-specific trace record</a> enumerated at label [1]. The second argument to the QS_BEGIN() macro is zero, which means that this record does not use any <a class="el" href="qs.html#qs_local">local filter</a>.  </dd>
<dt>8</dt>
<dd>The <a class="el" href="qpc__qs_8h.html#a7ad67719163eea844e44bee7f0478c0a">QS_STR()</a> data element outputs the message string.  </dd>
</dl>
<div style="clear:both;"></div><p> <br  />
</p>
<dl class="section remark"><dt>Remarks</dt><dd>In practice, you will likely use both functional and structural testing at the same time. Simple actions that do not perform any hardware-specific operations could be instrumented (with <a class="el" href="qs.html#qs_app">QS application-specific trace records</a>) directly in the CUT (your state machines). The hardware-specific actions need to be abstracted anyway (in the BSP for "dual targeting"), in which case you can place the QS instrumentation in the BSP only.</dd></dl>
<h1><a class="anchor" id="qutest_qhsm-funct-script"></a>
Test Script (Functional Testing)</h1>
<p>The following listing shows the <em>test script</em> for the QHsm tests (file <span class="img file_py"><code>test_qhsm-funct.py</code></span>). The explanation section following the listing clarifies the interesting lines of code (lines starting with <code>[xx]</code> labels).</p>
<div class="fragment"><div class="line"><span class="preprocessor">     # preamble...</span></div>
<div class="line"> [1] def on_reset():</div>
<div class="line"> [2]    glb_filter(GRP_UA)</div>
<div class="line"> [3]    current_obj(OBJ_SM, <span class="stringliteral">&quot;the_hsm&quot;</span>)</div>
<div class="line"> </div>
<div class="line">     # tests...</div>
<div class="line"> [4] test(<span class="stringliteral">&quot;QHsmTst init&quot;</span>)</div>
<div class="line"> [5] init()</div>
<div class="line"> [6] expect(<span class="stringliteral">&quot;@timestamp BSP_DISPLAY top-INIT;&quot;</span>)</div>
<div class="line">     expect(<span class="stringliteral">&quot;@timestamp BSP_DISPLAY s-ENTRY;&quot;</span>)</div>
<div class="line">     expect(<span class="stringliteral">&quot;@timestamp BSP_DISPLAY s2-ENTRY;&quot;</span>)</div>
<div class="line">     expect(<span class="stringliteral">&quot;@timestamp BSP_DISPLAY s2-INIT;&quot;</span>)</div>
<div class="line">     expect(<span class="stringliteral">&quot;@timestamp BSP_DISPLAY s21-ENTRY;&quot;</span>)</div>
<div class="line">     expect(<span class="stringliteral">&quot;@timestamp BSP_DISPLAY s211-ENTRY;&quot;</span>)</div>
<div class="line">     expect(<span class="stringliteral">&quot;@timestamp Trg-Done QS_RX_EVENT&quot;</span>)</div>
<div class="line"> </div>
<div class="line">     #------------------</div>
<div class="line"> [7] test(<span class="stringliteral">&quot;QHsmTst dispatch&quot;</span>, NORESET)</div>
<div class="line"> [8] dispatch(<span class="stringliteral">&quot;A_SIG&quot;</span>)</div>
<div class="line"> [9] expect(<span class="stringliteral">&quot;@timestamp BSP_DISPLAY s21-A;&quot;</span>)</div>
<div class="line">     expect(<span class="stringliteral">&quot;@timestamp BSP_DISPLAY s211-EXIT;&quot;</span>)</div>
<div class="line">     expect(<span class="stringliteral">&quot;@timestamp BSP_DISPLAY s21-EXIT;&quot;</span>)</div>
<div class="line">     expect(<span class="stringliteral">&quot;@timestamp BSP_DISPLAY s21-ENTRY;&quot;</span>)</div>
<div class="line">     expect(<span class="stringliteral">&quot;@timestamp BSP_DISPLAY s21-INIT;&quot;</span>)</div>
<div class="line">     expect(<span class="stringliteral">&quot;@timestamp BSP_DISPLAY s211-ENTRY;&quot;</span>)</div>
<div class="line">[10] expect(<span class="stringliteral">&quot;@timestamp Trg-Done QS_RX_EVENT&quot;</span>)</div>
<div class="line"> </div>
<div class="line">     dispatch(<span class="stringliteral">&quot;B_SIG&quot;</span>)</div>
<div class="line">     expect(<span class="stringliteral">&quot;@timestamp BSP_DISPLAY s21-B;&quot;</span>)</div>
<div class="line">     expect(<span class="stringliteral">&quot;@timestamp BSP_DISPLAY s211-EXIT;&quot;</span>)</div>
<div class="line">     expect(<span class="stringliteral">&quot;@timestamp BSP_DISPLAY s211-ENTRY;&quot;</span>)</div>
<div class="line">     expect(<span class="stringliteral">&quot;@timestamp Trg-Done QS_RX_EVENT&quot;</span>)</div>
<div class="line"> </div>
<div class="line">     ~ ~ ~</div>
</div><!-- fragment --><dl class="tag">
<dt>1</dt>
<dd>The script procedure <code>on_reset()</code> is executed after each reset of the target. This is in contrast to the procedure <code>on_setup()</code>, which is executed at the beginning of all tests, including tests that don't reset the target.  </dd>
<dt>2</dt>
<dd>The <a class="el" href="qs.html#qs_global">global filter</a> is set to <code>GRP_UA</code>, which means &laquo;<b>group-user-all</b>&raquo; trace records. This filter setting determines the character of the test to be a <b>functional</b> test, because the focus is on the trace records produced by actions (<a class="el" href="qs.html#qs_app">user-defined</a> records) rather than the <a class="el" href="qs.html#qs_pre">pre-defined records</a> generated by executing a state machine.  </dd>
<dt>3</dt>
<dd>The command current_obj() sets the current state machine object to <code>"the_hsm"</code>. Because this is performed in the on_reset() callback, this current object will be set before every test (except the NORESET-tests, which do not call on_reset()).  </dd>
</dl>
<div style="clear:both;"></div><p><b>Test: "QHsmTst init"</b> tests the top-most initial transition </p><dl class="tag">
<dt>4</dt>
<dd>The test() command starts the test.  </dd>
<dt>5</dt>
<dd>The init() command triggers the initial transition in the current state-machine object (see label [3]).  </dd>
<dt>6</dt>
<dd>The following expect() commands verify that all steps of the top-most initial transition are taken in the right order.  </dd>
</dl>
<div style="clear:both;"></div><p><b>Test: "QHsmTst dispatch"</b> tests dispatching various events to the state machine </p><dl class="tag">
<dt>7</dt>
<dd>The test() command starts the test.  </dd>
<dt>8</dt>
<dd>The dispatch() command dispatches a given event to the state machine.  </dd>
<dt>9</dt>
<dd>The expect() commands verify that the state machine <b>actions</b> (<code>BSP_display()</code> function) happened.  </dd>
<dt>10</dt>
<dd>This expect() command verifies that the processing of the event (see dispatch() at label [8]) has completed.  </dd>
</dl>
<div style="clear:both;"></div><h1><a class="anchor" id="qutest_qhsm-struct-script"></a>
Test Script (Structural Testing)</h1>
<p>The following listing shows the <em>test script</em> for the QHsm tests (file <span class="img file_py"><code>test_qhsm-struct.py</code></span>). The explanation section following the listing clarifies the interesting lines of code (lines starting with <code>[xx]</code> labels).</p>
<div class="fragment"><div class="line"><span class="preprocessor">     # preamble...</span></div>
<div class="line"> [1] def on_reset():</div>
<div class="line"> [2]    glb_filter(<a class="code hl_enumvalue" href="qspy_8h.html#a8dcf945571b727be2ac784fb2556bcdaadf5e1bb46a0abe33702c0ec950407159">GRP_SM</a>)</div>
<div class="line"> [3]    current_obj(OBJ_SM, <span class="stringliteral">&quot;the_hsm&quot;</span>)</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">     # tests...</div>
<div class="line"> [4] test(<span class="stringliteral">&quot;QHsmTst init&quot;</span>)</div>
<div class="line"> [5] init()</div>
<div class="line"> [6] expect(<span class="stringliteral">&quot;===RTC===&gt; St-Init  Obj=the_hsm,State=QHsm_top-&gt;QHsmTst_s2&quot;</span>)</div>
<div class="line">     expect(<span class="stringliteral">&quot;===RTC===&gt; St-Entry Obj=the_hsm,State=QHsmTst_s&quot;</span>)</div>
<div class="line">     expect(<span class="stringliteral">&quot;===RTC===&gt; St-Entry Obj=the_hsm,State=QHsmTst_s2&quot;</span>)</div>
<div class="line">     expect(<span class="stringliteral">&quot;===RTC===&gt; St-Init  Obj=the_hsm,State=QHsmTst_s2-&gt;QHsmTst_s211&quot;</span>)</div>
<div class="line">     expect(<span class="stringliteral">&quot;===RTC===&gt; St-Entry Obj=the_hsm,State=QHsmTst_s21&quot;</span>)</div>
<div class="line">     expect(<span class="stringliteral">&quot;===RTC===&gt; St-Entry Obj=the_hsm,State=QHsmTst_s211&quot;</span>)</div>
<div class="line">     expect(<span class="stringliteral">&quot;@timestamp Init===&gt; Obj=the_hsm,State=QHsmTst_s211&quot;</span>)</div>
<div class="line">     expect(<span class="stringliteral">&quot;@timestamp Trg-Done QS_RX_EVENT&quot;</span>)</div>
<div class="line"> </div>
<div class="line">     #------------------</div>
<div class="line"> [7] test(<span class="stringliteral">&quot;QHsmTst dispatch&quot;</span>, NORESET)</div>
<div class="line"> [8] dispatch(<span class="stringliteral">&quot;A_SIG&quot;</span>)</div>
<div class="line"> [9] expect(<span class="stringliteral">&quot;@timestamp Disp===&gt; Obj=the_hsm,Sig=A_SIG,State=QHsmTst_s211&quot;</span>)</div>
<div class="line">     expect(<span class="stringliteral">&quot;===RTC===&gt; St-Exit  Obj=the_hsm,State=QHsmTst_s211&quot;</span>)</div>
<div class="line">     expect(<span class="stringliteral">&quot;===RTC===&gt; St-Exit  Obj=the_hsm,State=QHsmTst_s21&quot;</span>)</div>
<div class="line">     expect(<span class="stringliteral">&quot;===RTC===&gt; St-Entry Obj=the_hsm,State=QHsmTst_s21&quot;</span>)</div>
<div class="line">     expect(<span class="stringliteral">&quot;===RTC===&gt; St-Init  Obj=the_hsm,State=QHsmTst_s21-&gt;QHsmTst_s211&quot;</span>)</div>
<div class="line">     expect(<span class="stringliteral">&quot;===RTC===&gt; St-Entry Obj=the_hsm,State=QHsmTst_s211&quot;</span>)</div>
<div class="line">     expect(<span class="stringliteral">&quot;@timestamp ===&gt;Tran Obj=the_hsm,Sig=A_SIG,State=QHsmTst_s21-&gt;QHsmTst_s211&quot;</span>)</div>
<div class="line">[10] expect(<span class="stringliteral">&quot;@timestamp Trg-Done QS_RX_EVENT&quot;</span>)</div>
<div class="line"> </div>
<div class="line">     dispatch(<span class="stringliteral">&quot;B_SIG&quot;</span>)</div>
<div class="line">     expect(<span class="stringliteral">&quot;@timestamp Disp===&gt; Obj=the_hsm,Sig=B_SIG,State=QHsmTst_s211&quot;</span>)</div>
<div class="line">     expect(<span class="stringliteral">&quot;===RTC===&gt; St-Exit  Obj=the_hsm,State=QHsmTst_s211&quot;</span>)</div>
<div class="line">     expect(<span class="stringliteral">&quot;===RTC===&gt; St-Entry Obj=the_hsm,State=QHsmTst_s211&quot;</span>)</div>
<div class="line">     expect(<span class="stringliteral">&quot;@timestamp ===&gt;Tran Obj=the_hsm,Sig=B_SIG,State=QHsmTst_s21-&gt;QHsmTst_s211&quot;</span>)</div>
<div class="line">     expect(<span class="stringliteral">&quot;@timestamp Trg-Done QS_RX_EVENT&quot;</span>)</div>
<div class="line"> </div>
<div class="line">     ~ ~ ~</div>
<div class="ttc" id="aqspy_8h_html_a8dcf945571b727be2ac784fb2556bcdaadf5e1bb46a0abe33702c0ec950407159"><div class="ttname"><a href="qspy_8h.html#a8dcf945571b727be2ac784fb2556bcdaadf5e1bb46a0abe33702c0ec950407159">GRP_SM</a></div><div class="ttdeci">@ GRP_SM</div><div class="ttdef"><b>Definition:</b> <a href="qspy_8h_source.html#l00179">qspy.h:179</a></div></div>
</div><!-- fragment --><dl class="tag">
<dt>1</dt>
<dd>The script procedure <code>on_reset()</code> is executed after each reset of the target. This is in contrast to the procedure <code>on_setup()</code>, which is executed at the beginning of all tests, including tests that don't reset the target.  </dd>
<dt>2</dt>
<dd>The <a class="el" href="qs.html#qs_global">global filter</a> is set to <code>GRP_SM</code>, which means &laquo;<b>group-state-machine</b>&raquo; trace records. This filter setting determines the character of the test to be a <b>structural</b> test, because the focus is on the <a class="el" href="qs.html#qs_pre">pre-defined records</a> generated by executing a state machine, rather than trace records produced by actions (user trace records).  </dd>
<dt>3</dt>
<dd>The command current_obj() sets the current state machine object to <code>"the_hsm"</code>. Because this is performed in the on_reset() callback, this current object will be set before every test (except the NORESET-tests, which do not call on_reset()).  </dd>
</dl>
<div style="clear:both;"></div><p><b>Test: "QHsmTst init"</b> tests the top-most initial transition </p><dl class="tag">
<dt>4</dt>
<dd>The test() command starts the test.  </dd>
<dt>5</dt>
<dd>The init() command triggers the initial transition in the current state-machine object (see label [3]).  </dd>
<dt>6</dt>
<dd>The following expect() commands verify that all steps of the top-most initial transition are taken in the right order.  </dd>
</dl>
<div style="clear:both;"></div><p><b>Test: "QHsmTst dispatch"</b> tests dispatching various events to the state machine </p><dl class="tag">
<dt>7</dt>
<dd>The test() command starts the test.  </dd>
<dt>8</dt>
<dd>The dispatch() command dispatches a given event to the state machine  </dd>
<dt>9</dt>
<dd>The expect() commands verify that the state machine RTC (Run-To-Completion) steps have been executed.  </dd>
<dt>10</dt>
<dd>This expect() command verifies that the processing of the event (see dispatch() at label [8]) has completed.  </dd>
</dl>
<div style="clear:both;"></div><p><br  />
 <span class="prev_button"><a class="el" href="qutest_mock.html">Unity Mock Example</a></span><span class="next_button"><a class="el" href="qutest_blinky.html">Blinky Example</a></span> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.9.2-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="qutest.html">QUTest&trade; Unit Testing Harness</a></li><li class="navelem"><a class="el" href="qutest_tut.html">QUTest&trade; Tutorial</a></li>
    <li class="footer">
<a title="Quantum Leaps: Modern Embedded Software" href="https://www.state-machine.com">&copy; 2005-2023 Quantum Leaps</a> &nbsp;|&nbsp; <a title="help" href="help.html">Using Online Help</a> &nbsp;|&nbsp; <b>QTools 7.2.1</b> &nbsp;|&nbsp; Updated on Thu Jan 26 2023
<hr class="footer"/><address class="footer"><small>
<a title="Quantum Leaps: Modern Embedded Software" href="https://www.state-machine.com">&copy; 2005-2023 Quantum Leaps</a> &nbsp;|&nbsp; <a title="help" href="help.html">Using Online Help</a> &nbsp;|&nbsp; <b>QTools 7.2.1</b> &nbsp;|&nbsp; Updated on Thu Jan 26 2023
</small></address>
    </li>
  </ul>
</div>
</body>
</html>
